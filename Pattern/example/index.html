<!doctype html>
<html>
<head>
	<script>

		addEvent(window, "load", function() {
			var q = new DED.Queue;
			q.setRetryCount(5);
			q.setTimeout(3000);

			var items = $("items");

			var results = $("results");

			var queue = $("queue-items");

			var requests = [ ];

			q.onFlush.subscribe(function(data) {
				result.innerHTML = data;
				requests.shift();
				queue.innerHTML = requests.toString();
			});

			q.onFailure.subscribe(function() {
				results.innerHTML += " <span style='color: red;'>Connection Error!</span>";
			});

			q.onComplete.subscribe(function() {
				results.innerHTML += "<span style='color: green;'>Complated!</span>";
			});

			var actionDispatcher = function(element) {
				switch (element) {
					case "flush":
						q.flash();
						break;
					case "dequeue":
						q.dequeue();
						requests.pop();
						queue.innerHTML = requests.toString();
						break;
					case "pause":
						q.pause();
						break;
					case "clear":
						q.clear();
						requests = [ ];
						queue.innerHTML = "";
						break;
				}
			};

			var addRequest = function(request) {
				var data = request.split("-")[1];
				q.add({
					method: "GET",
					uri: "bridge-connection-queue.php?ajax=true&s=" + data,
					params: null
				});
				requests.push(data);
				queue.innerHTML = requests.toString();
			};
			addEvent(items, "click", function(e) {
				var e = e || window.event;
				var src = e.target || e.srcElement;
				try {
					e.preventDefault();
				}
				catch (ex) {
					e.returnValue = false;
				}
				actionDispatcher(src.id);
			});

			var adders = $("adders");
			addEvent(adders, "click", function(e) {
				var e = e || window.event;
				var src = e.target || e.srcElement;
				try {
					e.preventDefault();
				}
				catch (ex) {
					e.returnValue = false;
				}
				addRequest(src.id);
			});
		});

	</script>
</head>
<body>


</body>
</html>